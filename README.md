# âš• MedVend Portal
## Design and Development of a Smart Medical Vending Machine with Sensor-Based Dispensing and IoT Monitoring

> **Final Year Project** â€” Cloud-connected Medical Card & Prescription Management System  
> Built with: HTML Â· CSS Â· Vanilla JavaScript Â· Firebase Auth Â· Firebase Firestore

---

## ğŸ“ Project Structure

```
medvend-portal/
â”‚
â”œâ”€â”€ index.html        â† Landing page (public)
â”œâ”€â”€ login.html        â† Authentication page
â”œâ”€â”€ dashboard.html    â† Patient dashboard (protected)
â”œâ”€â”€ doctor.html       â† Doctor dashboard (protected)
â”œâ”€â”€ style.css         â† All styles
â”œâ”€â”€ app.js            â† Firebase logic + all JavaScript
â””â”€â”€ README.md         â† This file
```

---

## ğŸ—„ Firestore Database Structure

```
Firestore Database
â”‚
â”œâ”€â”€ users/                         â† Collection
â”‚   â””â”€â”€ {userUID}/                 â† Document (auto-generated by Firebase Auth)
â”‚       â”œâ”€â”€ uid: "abc123"
â”‚       â”œâ”€â”€ name: "John Doe"
â”‚       â”œâ”€â”€ email: "john@example.com"
â”‚       â”œâ”€â”€ role: "patient"        â† "patient" or "doctor"
â”‚       â””â”€â”€ medicalCardID: "MED-2024-0001"
â”‚
â””â”€â”€ prescriptions/                 â† Collection
    â””â”€â”€ {patientUID}/              â† Document (keyed by patient UID for easy lookup)
        â”œâ”€â”€ patientUID: "abc123"
        â”œâ”€â”€ doctorUID: "doc456"
        â”œâ”€â”€ medicines: ["Paracetamol", "Amoxicillin"]
        â”œâ”€â”€ dosage: "500mg twice daily"
        â”œâ”€â”€ refillLimit: 3
        â”œâ”€â”€ expiryDate: "2025-06-30"
        â””â”€â”€ lastUpdated: Timestamp
```

---

## ğŸ”’ Firestore Security Rules

Copy and paste these rules into your Firebase Console:
**Firestore â†’ Rules tab**

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // USERS COLLECTION
    // - Any authenticated user can read their own profile
    // - Only the user themselves (or admin) can write their profile
    match /users/{userId} {
      allow read: if request.auth != null && request.auth.uid == userId;
      allow write: if request.auth != null && request.auth.uid == userId;

      // Allow doctors to read any user profile (for patient search by email)
      allow read: if request.auth != null
        && get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'doctor';
    }

    // PRESCRIPTIONS COLLECTION
    // - Only doctors can create or update prescriptions
    // - Patients can only read their own prescription
    match /prescriptions/{patientId} {
      // Patients: read own prescription only
      allow read: if request.auth != null
        && request.auth.uid == patientId;

      // Doctors: read and write any prescription
      allow read, write: if request.auth != null
        && get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'doctor';
    }
  }
}
```

---

## ğŸš€ Step-by-Step Firebase Setup

### Step 1 â€” Create a Firebase Project

1. Go to [https://console.firebase.google.com](https://console.firebase.google.com)
2. Click **"Add project"**
3. Enter project name: `medvend-portal` (or any name)
4. Disable Google Analytics (not needed) â†’ Click **Create project**
5. Wait for project to be created â†’ Click **Continue**

---

### Step 2 â€” Enable Firebase Authentication

1. In the left sidebar, click **Build â†’ Authentication**
2. Click **"Get started"**
3. Under **Sign-in method**, click **Email/Password**
4. Toggle **Enable** to ON
5. Click **Save**

---

### Step 3 â€” Create Firestore Database

1. In the left sidebar, click **Build â†’ Firestore Database**
2. Click **"Create database"**
3. Select **"Start in test mode"** (we'll add real rules later)
4. Choose your nearest region (e.g. `asia-southeast1` for Malaysia/SEA)
5. Click **Enable**

---

### Step 4 â€” Get Your Firebase Config

1. Click the **gear icon âš™** next to "Project Overview"
2. Click **Project settings**
3. Scroll down to **"Your apps"**
4. Click the **Web** icon `</>`
5. Enter app nickname: `MedVend Web`
6. Click **"Register app"**
7. Copy the `firebaseConfig` object shown â€” it looks like:

```javascript
const firebaseConfig = {
  apiKey: "AIza...",
  authDomain: "your-project.firebaseapp.com",
  projectId: "your-project-id",
  storageBucket: "your-project.appspot.com",
  messagingSenderId: "123456789",
  appId: "1:123456:web:abc123"
};
```

8. **Open `app.js`** and replace the placeholder config at the top with YOUR values.

---

### Step 5 â€” Add Firestore Security Rules

1. In Firestore, click the **Rules** tab
2. Replace the default rules with the rules shown in the **Security Rules** section above
3. Click **Publish**

---

### Step 6 â€” Create User Accounts Manually (For Testing)

Since this system doesn't have a public registration page (intentional, for security):

**Method A â€” Firebase Console:**

1. Go to **Authentication â†’ Users â†’ Add user**
2. Add a doctor account: `doctor@medvend.com` / password
3. Add a patient account: `patient@medvend.com` / password

**Method B â€” Firestore Documents:**

After creating auth accounts, add their profiles to Firestore:

1. Go to **Firestore â†’ users** collection
2. Click **"Add document"**
3. Use the user's UID as the Document ID (copy from Authentication tab)
4. Add these fields:

**For Doctor:**
```
uid: "paste-uid-here"
name: "Dr. Sarah Ahmed"
email: "doctor@medvend.com"
role: "doctor"
medicalCardID: ""
```

**For Patient:**
```
uid: "paste-uid-here"
name: "Ali Hassan"
email: "patient@medvend.com"
role: "patient"
medicalCardID: "MED-2024-0001"
```

---

## ğŸŒ Step-by-Step GitHub Hosting (GitHub Pages)

### Step 1 â€” Create GitHub Repository

1. Go to [https://github.com](https://github.com) â†’ Sign in
2. Click **"New"** (green button) to create a repository
3. Name it: `medvend-portal`
4. Set to **Public**
5. Click **"Create repository"**

### Step 2 â€” Upload Your Files

**Option A â€” GitHub Website (Easiest):**
1. In your new repository, click **"uploading an existing file"**
2. Drag and drop ALL project files: `index.html`, `login.html`, `dashboard.html`, `doctor.html`, `style.css`, `app.js`
3. Click **"Commit changes"**

**Option B â€” Git Command Line:**
```bash
# Navigate to your project folder
cd medvend-portal

# Initialize git
git init

# Add all files
git add .

# Commit
git commit -m "Initial commit: MedVend Portal"

# Add your GitHub repo as remote (replace YOUR_USERNAME)
git remote add origin https://github.com/YOUR_USERNAME/medvend-portal.git

# Push to GitHub
git push -u origin main
```

### Step 3 â€” Enable GitHub Pages

1. In your repository, click **Settings** tab
2. Scroll down to **Pages** (left sidebar)
3. Under **Source**, select: **Deploy from a branch**
4. Branch: **main** / Folder: **/ (root)**
5. Click **Save**
6. Wait ~2 minutes, then your site will be live at:
   `https://YOUR_USERNAME.github.io/medvend-portal/`

---

## ğŸ“¡ IoT Vending Machine Integration Guide

### How the Vending Machine Fetches Prescription Data

The vending machine (Arduino/Raspberry Pi with WiFi) uses the **Firestore REST API** to check prescriptions without needing the full Firebase SDK.

### API Endpoint

```
GET https://firestore.googleapis.com/v1/projects/{PROJECT_ID}/databases/(default)/documents/prescriptions/{PATIENT_UID}?key={API_KEY}
```

### Example Request (from Raspberry Pi / Python)

```python
import requests
import json

# Configuration
PROJECT_ID = "your-firebase-project-id"
API_KEY    = "your-firebase-api-key"

def get_prescription(patient_uid):
    """
    Fetch prescription data for a patient.
    Called when patient scans their Medical Card at the machine.
    """
    url = f"https://firestore.googleapis.com/v1/projects/{PROJECT_ID}/databases/(default)/documents/prescriptions/{patient_uid}?key={API_KEY}"

    response = requests.get(url, timeout=10)

    if response.status_code == 200:
        data = response.json()
        fields = data.get('fields', {})

        # Parse the Firestore response format
        prescription = {
            'medicines':   [m['stringValue'] for m in fields['medicines']['arrayValue']['values']],
            'dosage':      fields['dosage']['stringValue'],
            'refillLimit': int(fields['refillLimit']['integerValue']),
            'expiryDate':  fields['expiryDate']['stringValue'],
        }
        return prescription
    else:
        print(f"Error: {response.status_code}")
        return None

# ---- Vending Machine Main Logic ----
# 1. Scan Medical Card ID (barcode/RFID)
card_id = scan_medical_card()  # Your scanner function

# 2. Look up patient UID from card_id
#    (Store this mapping in the machine or fetch from Firestore)
patient_uid = lookup_uid_from_card(card_id)

# 3. Get prescription
prescription = get_prescription(patient_uid)

if prescription:
    print(f"Dispensing: {prescription['medicines']}")
    # Activate motor/servo to dispense medicine
    dispense_medicine(prescription['medicines'])
else:
    print("No valid prescription found")
    display_error("Please consult your doctor")
```

### Example Arduino (ESP8266/ESP32) HTTP Request

```cpp
#include <ESP8266WiFi.h>
#include <ESP8266HTTPClient.h>
#include <ArduinoJson.h>

const char* ssid     = "YOUR_WIFI_SSID";
const char* password = "YOUR_WIFI_PASSWORD";
const char* PROJECT  = "your-project-id";
const char* API_KEY  = "your-api-key";

void fetchPrescription(String patientUID) {
  HTTPClient http;
  String url = "https://firestore.googleapis.com/v1/projects/" + 
               String(PROJECT) + 
               "/databases/(default)/documents/prescriptions/" + 
               patientUID + "?key=" + String(API_KEY);
  
  http.begin(url);
  int httpCode = http.GET();
  
  if (httpCode == 200) {
    String payload = http.getString();
    // Parse JSON and control dispensing motors
    Serial.println("Prescription found: " + payload);
    activateDispenser(); // Your motor control function
  }
  
  http.end();
}
```

---

## ğŸ— System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CLOUD LAYER                          â”‚
â”‚              Firebase (Google Cloud)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Firebase Auth  â”‚    â”‚   Firestore Database     â”‚   â”‚
â”‚  â”‚  (Login/Roles)  â”‚    â”‚  users + prescriptions   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                         â”‚                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                         â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   WEB PORTAL    â”‚    â”‚   IoT VENDING MACHINE  â”‚
    â”‚                 â”‚    â”‚                         â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚ â”‚   Doctor    â”‚ â”‚    â”‚  â”‚  Card Scanner   â”‚   â”‚
    â”‚ â”‚  Dashboard  â”‚ â”‚    â”‚  â”‚  (RFID/Barcode) â”‚   â”‚
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚           â”‚             â”‚
    â”‚ â”‚   Patient   â”‚ â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚ â”‚  Dashboard  â”‚ â”‚    â”‚  â”‚  REST API Call  â”‚   â”‚
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚           â”‚             â”‚
                           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                           â”‚  â”‚  Servo/Motor    â”‚   â”‚
                           â”‚  â”‚  Dispenser      â”‚   â”‚
                           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”˜
```

---

## ğŸ§ª Test Accounts (Setup These in Firebase)

| Role    | Email                   | Password     | Notes                        |
|---------|-------------------------|--------------|------------------------------|
| Doctor  | doctor@medvend.com      | Doctor123!   | Can write prescriptions      |
| Patient | patient@medvend.com     | Patient123!  | Read-only medical card       |

---

## ğŸ“‹ Technologies Used

| Technology        | Purpose                              |
|-------------------|--------------------------------------|
| HTML5             | Page structure                       |
| CSS3              | Styling + responsive layout          |
| Vanilla JS (ES6)  | Logic, DOM manipulation              |
| Firebase Auth     | Email/password authentication        |
| Firebase Firestore| NoSQL cloud database                 |
| Google Fonts      | Typography (Syne + DM Sans)          |
| GitHub Pages      | Free static hosting                  |

---

## ğŸ‘¨â€ğŸ’» Author

**Final Year Project â€” Computer Science / IT**  
Submitted for University Final Review  
System: Smart Medical Vending Machine with IoT Monitoring

---

*For questions or improvements, open an issue on GitHub.*
